{% extends 'base.html' %}
{% block content %}
<div class="container-fluid py-4">
  <div class="row">
    <div class="col-12">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="mb-1">
            <i class="fas fa-building me-2"></i>{{ organization.name }}
          </h2>
          <p class="text-muted mb-0">
            <small><i class="fas fa-link me-1"></i>{{ organization.slug }}</small>
            {% if organization.is_active %}
              <span class="badge bg-success ms-2">Active</span>
            {% else %}
              <span class="badge bg-secondary ms-2">Inactive</span>
            {% endif %}
          </p>
        </div>
        <a href="/" class="btn btn-outline-secondary">
          <i class="fas fa-arrow-left me-1"></i>Back to Home
        </a>
      </div>

      <!-- Stats Cards -->
      <div class="row g-3 mb-4">
        <div class="col-md-6 col-lg-3">
          <div class="card">
            <div class="card-body text-center">
              <i class="fas fa-users text-primary mb-2" style="font-size: 2rem;"></i>
              <h3 class="mb-0">{{ total_users }}</h3>
              <p class="text-muted mb-0"><small>Team Members</small></p>
            </div>
          </div>
        </div>
        <div class="col-md-6 col-lg-3">
          <div class="card">
            <div class="card-body text-center">
              <i class="fas fa-calendar-check text-info mb-2" style="font-size: 2rem;"></i>
              <h6 class="mb-0">{{ organization.created_at|date:"M d, Y" }}</h6>
              <p class="text-muted mb-0"><small>Established</small></p>
            </div>
          </div>
        </div>
        <div class="col-md-6 col-lg-3">
          <div class="card">
            <div class="card-body text-center">
              <i class="fas fa-map-marker-alt text-success mb-2" style="font-size: 2rem;"></i>
              {% if organization.city %}
                <h6 class="mb-0">{{ organization.city }}</h6>
              {% else %}
                <h6 class="mb-0 text-muted">Not Set</h6>
              {% endif %}
              <p class="text-muted mb-0"><small>Location</small></p>
            </div>
          </div>
        </div>
        <div class="col-md-6 col-lg-3">
          <div class="card">
            <div class="card-body text-center">
              <i class="fas fa-file-invoice text-warning mb-2" style="font-size: 2rem;"></i>
              {% if organization.gstin %}
                <h6 class="mb-0" style="font-size: 0.85rem;">{{ organization.gstin|slice:":10" }}...</h6>
              {% else %}
                <h6 class="mb-0 text-muted">Not Set</h6>
              {% endif %}
              <p class="text-muted mb-0"><small>GSTIN</small></p>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <!-- Left Column - Organization Info & Business Details -->
        <div class="col-lg-6 mb-3">
          <!-- Contact Information Card -->
          <div class="card mb-3">
            <div class="card-header">
              <h5 class="mb-0"><i class="fas fa-address-book me-2"></i>Contact Information</h5>
            </div>
            <div class="card-body">
              <table class="table table-sm mb-0">
                <tbody>
                  <tr>
                    <td style="width: 120px;"><i class="fas fa-envelope me-2"></i><strong>Email</strong></td>
                    <td>
                      {% if organization.contact_email %}
                        <a href="mailto:{{ organization.contact_email }}">{{ organization.contact_email }}</a>
                      {% else %}
                        <span class="text-muted">Not provided</span>
                      {% endif %}
                    </td>
                  </tr>
                  <tr>
                    <td><i class="fas fa-phone me-2"></i><strong>Phone</strong></td>
                    <td>
                      {% if organization.contact_phone %}
                        <a href="tel:{{ organization.contact_phone }}">{{ organization.contact_phone }}</a>
                      {% else %}
                        <span class="text-muted">Not provided</span>
                      {% endif %}
                    </td>
                  </tr>
                  <tr>
                    <td><i class="fas fa-map-marker-alt me-2"></i><strong>Address</strong></td>
                    <td>
                      {% if organization.address %}
                        {{ organization.address }}
                        {% if organization.city or organization.state or organization.pincode %}
                          <br>{% if organization.city %}{{ organization.city }}{% endif %}{% if organization.state %}, {{ organization.state }}{% endif %}{% if organization.pincode %} - {{ organization.pincode }}{% endif %}
                        {% endif %}
                      {% else %}
                        <span class="text-muted">Not provided</span>
                      {% endif %}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Business Details Card -->
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0"><i class="fas fa-briefcase me-2"></i>Business Details</h5>
            </div>
            <div class="card-body">
              <table class="table table-sm mb-0">
                <tbody>
                  <tr>
                    <td style="width: 120px;"><i class="fas fa-file-invoice me-2"></i><strong>GSTIN</strong></td>
                    <td>
                      {% if organization.gstin %}
                        <code>{{ organization.gstin }}</code>
                      {% else %}
                        <span class="text-muted">Not provided</span>
                      {% endif %}
                    </td>
                  </tr>
                  <tr>
                    <td><i class="fas fa-id-card me-2"></i><strong>PAN</strong></td>
                    <td>
                      {% if organization.pan %}
                        <code>{{ organization.pan }}</code>
                      {% else %}
                        <span class="text-muted">Not provided</span>
                      {% endif %}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Right Column - Users List -->
        <div class="col-lg-6 mb-3">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-users me-2"></i>Team Members
                <span class="badge bg-primary">{{ total_users }}</span>
              </h5>
            </div>
            <div class="card-body p-0">
              {% if user_profiles %}
                <div class="table-responsive">
                  <table class="table table-hover mb-0">
                    <thead>
                      <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Role/Dept</th>
                        <th>Joined</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for profile in user_profiles %}
                      <tr>
                        <td>
                          {{ profile.user.get_full_name|default:profile.user.username }}
                          {% if profile.user == request.user %}
                            <span class="badge bg-info">You</span>
                          {% endif %}
                        </td>
                        <td><small>{{ profile.user.email }}</small></td>
                        <td>
                          {% if profile.role %}
                            <span class="badge bg-primary">{{ profile.role }}</span>
                          {% endif %}
                          {% if profile.department %}
                            <span class="badge bg-secondary">{{ profile.department }}</span>
                          {% endif %}
                        </td>
                        <td><small>{{ profile.user.date_joined|date:"M d, Y" }}</small></td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              {% else %}
                <div class="text-center p-4 text-muted">
                  <i class="fas fa-users fa-3x mb-2"></i>
                  <p>No team members found</p>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      <!-- Metadata Footer -->
      <div class="card bg-light">
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <small class="text-muted">
                <i class="fas fa-plus-circle me-1"></i>
                Created on <strong>{{ organization.created_at|date:"F d, Y" }}</strong> at {{ organization.created_at|time:"g:i A" }}
              </small>
            </div>
            <div class="col-md-6 text-md-end">
              <small class="text-muted">
                <i class="fas fa-sync-alt me-1"></i>
                Last updated on <strong>{{ organization.updated_at|date:"F d, Y" }}</strong> at {{ organization.updated_at|time:"g:i A" }}
              </small>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
{% endblock %}
